<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的購物車 - EatFast</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['Noto Sans TC', 'sans-serif'],
              },
              colors: {
                'brand-bg': '#FDFBF6',
                'brand-container': '#F5EFE6',
                'brand-primary': '#A67B5B',
                'brand-primary-hover': '#8C684A',
                'brand-text': '#5D534A',
                'brand-deep': '#3C2A21',
                'brand-accent': '#E1A87A',
              }
            }
          }
        }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    
    <style>
        /* 由於 Tailwind 配置已在 <script> 中定義，這裡的 :root 就不再需要 */
        /* 將 body 樣式直接映射到 Tailwind class */
        body {
            font-family: 'Noto Sans TC', sans-serif; /* Fallback for font-sans */
        }
        /* 自定義按鈕顏色，以防 Tailwind 默認或配置未能完全覆蓋 */
        .btn-primary-custom {
            background-color: var(--colors-brand-primary);
            color: white;
        }
        .btn-primary-custom:hover {
            background-color: var(--colors-brand-primary-hover);
        }
        .btn-danger-custom {
            background-color: #EF4444; /* Tailwind red-500 */
            color: white;
        }
        .btn-danger-custom:hover {
            background-color: #DC2626; /* Tailwind red-600 */
        }
        .btn-secondary-custom {
            background-color: #E5E7EB; /* Tailwind gray-200 */
            color: #4B5563; /* Tailwind gray-700 */
        }
        .btn-secondary-custom:hover {
            background-color: #D1D5DB; /* Tailwind gray-300 */
        }

        /* 為了防止圖片路徑問題，這裡提供一個默認圖片，您應該替換為實際的餐點圖片 */
        .meal-placeholder-img {
            background-color: #F3F4F6; /* Tailwind gray-100 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #9CA3AF; /* Tailwind gray-400 */
        }
        .meal-placeholder-img i {
            font-size: 2rem;
        }
    </style>
</head>
<body class="bg-brand-bg text-brand-text antialiased">

    <header class="bg-white shadow-md fixed top-0 left-0 w-full z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            
            <div class="flex-shrink-0">
                <a th:href="@{/welcome}" class="flex items-center">
                    <img th:src="@{/images/123.png}" alt="Logo" class="w-12 h-12 rounded-full mr-2">
                    <span class="text-xl font-bold text-brand-deep">EatFast 早安！</span>
                </a>
            </div>

            <div class="hidden md:flex space-x-8"> 
                <a href="/welcome" class="text-brand-text hover:text-brand-primary font-medium text-lg">關於我們</a>
                <a href="/welcome" class="text-brand-text hover:text-brand-primary font-medium text-lg">最新消息</a>
                <a th:href="@{/store/select_page_store}" class="text-brand-primary font-bold text-lg">門市據點</a> 
                <a th:href="@{/menu}" class="text-brand-text hover:text-brand-primary font-medium text-lg">我要訂餐</a> 
                <a th:href="@{/cart}" class="text-brand-primary font-bold text-lg">購物車</a> </div>

            <div class="hidden md:flex items-center space-x-4">
                <a href="/api/v1/auth/member-login" class="bg-brand-accent text-brand-deep font-bold px-5 py-2 rounded-full hover:bg-orange-400 transition-colors shadow-sm">
                    登入/註冊
                </a>
            </div>

        </nav>
    </header>

	<main class="container mx-auto p-4 md:p-8 pt-28 md:pt-32">
		<div class="flex flex-col md:flex-row gap-8">

			<aside class="w-full md:w-64 flex-shrink-0">
				<div class="bg-brand-container p-4 rounded-lg shadow-md h-full">
					<h2
						class="text-xl font-bold text-brand-deep mb-4 border-b-2 border-gray-300 pb-2">餐點分類</h2> 
					<nav class="space-y-2">
						<a th:href="@{/meal/list(type='漢堡')}"
							class="block w-full text-left px-4 py-2 rounded-md transition-colors duration-200 hover:bg-brand-primary hover:text-white">漢堡</a>
						<a th:href="@{/meal/list(type='吐司')}"
							class="block w-full text-left px-4 py-2 rounded-md transition-colors duration-200 hover:bg-brand-primary hover:text-white">吐司</a>
						<a th:href="@{/meal/list(type='麵類')}"
							class="block w-full text-left px-4 py-2 rounded-md transition-colors duration-200 hover:bg-brand-primary hover:text-white">麵類</a>
						<a th:href="@{/meal/list(type='蛋餅')}"
							class="block w-full text-left px-4 py-2 rounded-md transition-colors duration-200 hover:bg-brand-primary hover:text-white">蛋餅</a>
						<a th:href="@{/meal/list(type='飲品')}"
							class="block w-full text-left px-4 py-2 rounded-md transition-colors duration-200 hover:bg-brand-primary hover:text-white">飲品</a>
					</nav>
				</div>
			</aside>

			<section class="flex-grow">
				<div
					class="bg-white p-6 md:p-8 rounded-lg shadow-md border border-gray-200">
					<h1 class="text-2xl font-bold text-brand-primary mb-6 text-center">我的購物車</h1>

					<div id="not-logged-in-message" class="text-center text-lg text-red-500 py-8 hidden">
                        <p class="mb-4"><i class="fas fa-exclamation-triangle mr-2"></i>請先登入會員才能使用購物車功能。</p>
                        <p><a th:href="@{/login}" class="bg-brand-primary text-white px-4 py-2 rounded hover:bg-brand-primary-hover"><i class="fas fa-sign-in-alt mr-2"></i>前往登入</a></p>
                    </div>

					<div id="cart-content" class="hidden"> 
						<table class="w-full text-left mb-6">
							<thead class="border-b-2 border-gray-300">
								<tr>
									<th class="py-2 font-semibold">餐點品項</th>
									<th class="py-2 font-semibold text-right w-24">單價</th>
									<th class="py-2 font-semibold text-center w-32">數量</th>
									<th class="py-2 font-semibold text-right w-24">小計</th>
									<th class="w-20"></th>
								</tr>
							</thead>
							<tbody id="cart-items-body">
								<tr id="loading-row">
									<td colspan="5" class="text-center py-4">載入中...</td>
								</tr>
							</tbody>
						</table>

						<div class="flex justify-start mb-8">
							<button id="clear-cart-btn"
								class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-700 text-sm flex items-center shadow-sm transition-colors">
								<i class="fas fa-trash-alt mr-2"></i>清空購物車
							</button>
						</div>

						<div class="space-y-4 border-t border-gray-300 pt-8 mt-8">
							<div class="flex items-center">
								<label for="pickup-store"
									class="w-24 font-semibold flex-shrink-0">取餐門市</label> <input
									type="text" id="pickup-store" value="二號店"
									class="flex-grow p-2 border rounded-md bg-gray-100" readonly>
							</div>
							<div class="flex items-center">
								<label for="pickup-time"
									class="w-24 font-semibold flex-shrink-0">取餐時間</label> <select
									id="pickup-time" class="flex-grow p-2 border rounded-md"></select>
							</div>
							<div class="flex items-start">
								<label for="notes" class="w-24 font-semibold mt-2 flex-shrink-0">備註</label>
								<textarea id="notes" rows="3"
									class="flex-grow p-2 border rounded-md"
									placeholder="例如：不加生菜、飲料去冰等..."></textarea>
							</div>
						</div>

						<div class="border-t mt-8 pt-6 flex justify-between items-center">
							<div>
								<span class="text-xl font-bold text-brand-text">總金額： <span
									id="cart-total-amount" class="text-2xl text-red-600">NT$
										0</span>
								</span>
							</div>
							<div class="flex items-center space-x-4">
								<a th:href="@{/menu}"
									class="bg-gray-200 text-gray-800 font-bold px-8 py-3 rounded-md hover:bg-gray-300 transition-colors">←
									繼續購物</a>
								<button id="checkout-btn"
									class="bg-brand-accent text-brand-deep font-bold px-8 py-3 rounded-lg hover:bg-orange-400 transition-colors shadow">前往結帳</button>
							</div>
						</div>
					</div>

					<div id="empty-cart-message"
						class="text-center text-lg text-gray-500 py-8 hidden">
						<p>您的購物車是空的，快去選購吧！</p>
						<p class="mt-4">
							<a th:href="@{/}"
								class="bg-brand-primary text-white px-4 py-2 rounded hover:bg-brand-primary-hover">開始購物</a>
						</p>
					</div>
				</div>
			</section>
		</div>
	</main>

	<footer
		class="bg-brand-deep text-brand-container text-center p-6 mt-16">
		<p>&copy; 2025 EatFast 早餐店 - 版權所有</p>
	</footer>

	<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // --- 元素選擇 ---
        // 【修正】: 將所有 DOM 元素獲取放在最前面
        const messageContainer = document.getElementById('message-container');
        const cartItemsBody = document.getElementById('cart-items-body');
        const cartTotalAmountSpan = document.getElementById('cart-total-amount');
        const emptyCartMessageDiv = document.getElementById('empty-cart-message');
        const cartContentDiv = document.getElementById('cart-content');
        const notLoggedInMessageDiv = document.getElementById('not-logged-in-message');
        const clearCartBtn = document.getElementById('clear-cart-btn');
        const checkoutBtn = document.getElementById('checkout-btn');

        // 【診斷點】: 在這裡立即檢查 messageContainer 是否為 null
        // console.log("DEBUG: messageContainer element found:", messageContainer); 

        // --- 設定 ---
        // 【重要】會員登入狀態和 ID，由後端 Thymeleaf 傳入
        // 為了前端測試，暫時將它們硬編碼，完成測試後請務必移除這兩行的硬編碼，
        // 讓它們回到從後端的 `th:inline` 獲取，例如：
        // const IS_LOGGED_IN = /*[[${isLoggedIn}]]*/ false;
        // const MEMBER_ID = /*[[${memberId}]]*/ null;
        const IS_LOGGED_IN = true; // 暫時設為 true 模擬已登入
        const MEMBER_ID = 1;       // 暫時設為一個假會員ID，確保不為 null
        
        const USE_MOCK_DATA = true; // true: 使用假資料, false: 使用真實 API
        
        const contextPath = /*[[@{/}]]*/ '/demo/'; 
        const API_CART_BASE_URL = contextPath + 'cart/api'; 
        
     // --- 取餐時間選項生成 (原封不動) ---
        const pickupTimeSelect = document.getElementById('pickup-time');
        if (pickupTimeSelect) { // 這裡會檢查 pickupTimeSelect 是否存在
            const now = new Date();
            now.setMinutes(now.getMinutes() + 20); // 加上20分鐘準備時間
            const minutes = now.getMinutes();
            const roundedMinutes = Math.ceil(minutes / 15) * 15; // 調整到下一個15分鐘的整點
            now.setMinutes(roundedMinutes, 0, 0);

            const closingTime = new Date(now);
            closingTime.setHours(14, 0, 0, 0); // 營業到下午2點
            
            while (now <= closingTime) {
                const option = document.createElement('option');
                const hours = String(now.getHours()).padStart(2, '0');
                const mins = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${mins}`;
                option.value = timeString;
                option.textContent = timeString;
                pickupTimeSelect.appendChild(option);
                now.setMinutes(now.getMinutes() + 15);
            }
        }

        // --- 假資料 ---
        const mockCartItems = [
            {
                cartId: 1001, 
                memberId: MEMBER_ID,
                mealId: 1,
                mealName: "招牌總匯三明治",
                mealPrice: 75, 
                mealPicUrl: contextPath + "images/meal_burger.png", // 假設圖片路徑
                storeId: 1,
                storeName: "旗艦店",
                quantity: 2,
                mealCustomization: "不要美乃滋，麵包烤酥一點",
                createdAt: "2025-07-01T10:00:00"
            },
            {
                cartId: 1002,
                memberId: MEMBER_ID,
                mealId: 5,
                mealName: "特選大冰奶",
                mealPrice: 45,
                mealPicUrl: contextPath + "images/meal_drink.png", // 假設圖片路徑
                storeId: 1,
                storeName: "旗艦店",
                quantity: 3,
                mealCustomization: "半糖去冰",
                createdAt: "2025-07-01T10:05:00"
            },
            {
                cartId: 1003,
                memberId: MEMBER_ID,
                mealId: 8,
                mealName: "蘑菇鐵板麵",
                mealPrice: 80, 
                mealPicUrl: contextPath + "images/meal_noodle.png", // 假設圖片路徑
                storeId: 2, 
                storeName: "二號店",
                quantity: 1,
                mealCustomization: "加辣",
                createdAt: "2025-07-01T10:10:00"
            },
            {
                cartId: 1004,
                memberId: MEMBER_ID,
                mealId: 2,
                mealName: "火腿蛋吐司",
                mealPrice: 40, 
                mealPicUrl: contextPath + "images/meal_toast.png", // 假設圖片路徑
                storeId: 1, 
                storeName: "旗艦店",
                quantity: 1,
                mealCustomization: "",
                createdAt: "2025-07-01T10:15:00"
                }
            ];


        // --- 輔助函式 ---

        // 載入購物車資料（主函式）
        async function loadCart() {
            cartItemsBody.innerHTML = '<tr id="loading-row"><td colspan="5" class="text-center py-4">載入中...</td></tr>';
            // 清空頂部訊息
            if (messageContainer) { // 確保元素存在才操作
                messageContainer.classList.add('hidden');
                messageContainer.textContent = '';
            }

            if (!IS_LOGGED_IN || MEMBER_ID === null) {
                displayNotLoggedIn();
                return;
            }

            if (USE_MOCK_DATA) {
                await new Promise(resolve => setTimeout(resolve, 500)); 
                if (mockCartItems.length === 0) {
                    displayEmptyCart();
                } else {
                    renderCartItems(mockCartItems);
                }
            } else { 
                try {
                    const response = await fetch(`${API_CART_BASE_URL}/member/${MEMBER_ID}`);
                    
                    if (response.status === 204) {
                        displayEmptyCart();
                        return;
                    }

                    if (!response.ok) {
                        console.error(`載入購物車非正常響應: 狀態碼 ${response.status}, URL: ${response.url}`);
                        displayEmptyCart(); 
                        return;
                    }

                    const cartItems = await response.json(); 
                    
                    if (cartItems.length === 0) {
                        displayEmptyCart();
                    } else {
                        renderCartItems(cartItems);
                    }
                } catch (error) {
                    console.error('載入購物車發生未知錯誤或網絡問題:', error);
                    displayEmptyCart(); 
                }
            }
        }

        // 渲染購物車項目列表
        function renderCartItems(items) {
            cartItemsBody.innerHTML = '';
            let totalAmount = 0;

            items.forEach(item => {
                const mealPrice = item.mealPrice; 
                const subtotal = mealPrice * item.quantity;
                totalAmount += subtotal;

                const row = document.createElement('tr');
                row.className = 'border-b';
                
                row.innerHTML = `
                    <td class="py-4 flex items-center">
                        <img src="${item.mealPicUrl || contextPath + 'images/meal_default.png'}" alt="${item.mealName}" class="w-16 h-16 rounded-md mr-4 object-cover meal-placeholder-img">
                        <div>
                            <span class="font-medium">${item.mealName || '未知餐點'}</span>
                            <p class="text-sm text-gray-500">(${item.storeName ? `(${item.storeName})` : ''} ${item.mealCustomization ? `<br>備註: ${item.mealCustomization}` : ''}</p>
                        </div>
                    </td>
                    <td class="py-4 align-middle text-right">NT$ ${mealPrice}</td>
                    <td class="py-4 align-middle">
                        <div class="flex items-center justify-center">
                            <button class="px-2 py-1 border rounded-l-md minus-btn" data-cart-id="${item.cartId}" data-member-id="${item.memberId}" data-store-id="${item.storeId}" data-meal-id="${item.mealId}">-</button>
                            <input type="number" value="${item.quantity}" min="1" class="w-12 text-center border-t border-b quantity-input" data-cart-id="${item.cartId}" data-member-id="${item.memberId}" data-store-id="${item.storeId}" data-meal-id="${item.mealId}">
                            <button class="px-2 py-1 border rounded-r-md plus-btn" data-cart-id="${item.cartId}" data-member-id="${item.memberId}" data-store-id="${item.storeId}" data-meal-id="${item.mealId}">+</button>
                        </div>
                    </td>
                    <td class="py-4 align-middle text-right">NT$ ${subtotal}</td>
                    <td class="py-4 align-middle text-center">
                        <button class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors shadow-sm delete-btn" data-cart-id="${item.cartId}" data-member-id="${item.memberId}" data-store-id="${item.storeId}" data-meal-id="${item.mealId}">刪除</button>
                    </td>
                `;
                cartItemsBody.appendChild(row);
            });
            cartTotalAmountSpan.textContent = totalAmount; 
            toggleEmptyCartMessage(false); 
            if (IS_LOGGED_IN && notLoggedInMessageDiv) {
                notLoggedInMessageDiv.classList.add('hidden');
            }
            attachEventListeners(); 
        }

        // 顯示或隱藏「購物車為空」的訊息
        function toggleEmptyCartMessage(showEmpty) {
            if (showEmpty) {
                cartContentDiv.classList.add('hidden');
                emptyCartMessageDiv.classList.remove('hidden');
            } else {
                cartContentDiv.classList.remove('hidden');
                emptyCartMessageDiv.classList.add('hidden');
            }
        }

        // 顯示未登入訊息
        function displayNotLoggedIn() {
            cartContentDiv.classList.add('hidden');
            emptyCartMessageDiv.classList.add('hidden');
            notLoggedInMessageDiv.classList.remove('hidden');
        }

        // 顯示頂部成功/失敗訊息
        function showMessage(type, message) {
            // 這個函數現在可以在確保 messageContainer 不為 null 後安全調用
            if (messageContainer) { // 【修正】: 在使用前檢查 messageContainer
                messageContainer.textContent = message;
                messageContainer.classList.remove('hidden', 'message-success', 'message-error');
                if (type === 'success') {
                    messageContainer.classList.add('message-success');
                } else if (type === 'error') {
                    messageContainer.classList.add('message-error');
                } else {
                    messageContainer.classList.add('hidden'); 
                }
            } else {
                console.warn("Message container element not found. Message: " + message);
            }
        }
        
        // 綁定所有按鈕的點擊事件 (區分假資料與真實 API 模式)
        function attachEventListeners() {
            // 清空之前的事件監聽器，避免重複綁定
            clearCartBtn.removeEventListener('click', clearCart);
            checkoutBtn.removeEventListener('click', handleCheckout);

            // 針對每個動態生成的按鈕，都需要移除舊的監聽器再重新綁定
            // 如果這些按鈕是動態生成的，每次 renderCartItems 後都需要重新查詢並綁定
            cartItemsBody.querySelectorAll('.plus-btn, .minus-btn, .quantity-input, .delete-btn').forEach(element => {
                element.removeEventListener('click', handleMockCartAction);
                element.removeEventListener('change', handleMockCartAction); 
                // 移除真實 API 模式的監聽器 (如果有的話)
                // element.removeEventListener('click', updateQuantityWrapper); 
                // element.removeEventListener('change', updateQuantityWrapper);
                // element.removeEventListener('click', deleteCartItemWrapper);
            });


            if (USE_MOCK_DATA) {
                cartItemsBody.querySelectorAll('.plus-btn, .minus-btn, .quantity-input, .delete-btn').forEach(element => {
                    element.addEventListener('click', handleMockCartAction);
                    element.addEventListener('change', handleMockCartAction); 
                });
                clearCartBtn.addEventListener('click', handleMockClearCart);
                checkoutBtn.addEventListener('click', handleCheckout); 
            } else { 
                cartItemsBody.querySelectorAll('.plus-btn').forEach(button => {
                    button.addEventListener('click', (e) => updateQuantity(e.target, 1));
                });
                cartItemsBody.querySelectorAll('.minus-btn').forEach(button => {
                    button.addEventListener('click', (e) => updateQuantity(e.target, -1));
                });
                cartItemsBody.querySelectorAll('.quantity-input').forEach(input => {
                    input.addEventListener('change', (e) => updateQuantity(e.target, 0)); 
                });
                cartItemsBody.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => deleteCartItem(e.target));
                });
                clearCartBtn.addEventListener('click', clearCart);
                checkoutBtn.addEventListener('click', handleCheckout); 
            }
        }

        // 假資料模式下的操作處理 (彈出提示並刷新)
        function handleMockCartAction(e) {
            alert("假資料模式下，購物車操作僅供UI測試，無實際後端互動！");
            loadCart(); 
        }
        function handleMockClearCart() {
            alert("假資料模式下，清空購物車功能僅供UI測試，無實際後端互動！");
            displayEmptyCart();
        }
        function handleCheckout() {
            alert('結帳功能尚未實作！');
        }


        // --- 以下是真實 API 模式下會呼叫的異步函數 (其行為在假資料模式下被模擬) ---

        async function updateQuantity(element, delta) {
            const memberId = element.dataset.memberId;
            const storeId = element.dataset.storeId;
            const mealId = element.dataset.mealId;
            const quantityInput = element.parentNode.querySelector('.quantity-input');
            let newQuantity;

            if (delta === 0) {
                newQuantity = parseInt(quantityInput.value);
                if (isNaN(newQuantity) || newQuantity < 0) {
                    showMessage('error', '數量必須是有效的數字且不小於0。');
                    loadCart(); 
                    return;
                }
            } else {
                newQuantity = parseInt(quantityInput.value) + delta;
            }

            if (newQuantity <= 0) {
                if (confirm('確定要從購物車移除此餐點嗎？')) {
                    deleteCartItem(element);
                } else {
                    loadCart(); 
                }
                return;
            }

            try {
                const response = await fetch(`${API_CART_BASE_URL}/member/${memberId}/store/${storeId}/meal/${mealId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ quantity: newQuantity, mealCustomization: '' }) 
                });

                if (!response.ok) {
                    if (response.status === 404) { throw new Error('購物車項目不存在或已過期。'); }
                    throw new Error(`更新數量失敗 (狀態碼: ${response.status})`);
                }

                showMessage('success', '購物車數量已更新！');
                loadCart(); 

            } catch (error) {
                console.error('更新數量失敗:', error);
                showMessage('error', `更新購物車失敗: ${error.message}`);
                loadCart(); 
            }
        }

        async function deleteCartItem(element) {
            if (!confirm('確定要從購物車移除此餐點嗎？')) {
                return;
            }

            const memberId = element.dataset.memberId;
            const storeId = element.dataset.storeId;
            const mealId = element.dataset.mealId;

            try {
                const response = await fetch(`${API_CART_BASE_URL}/member/${memberId}/store/${storeId}/meal/${mealId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    if (response.status === 404) { throw new Error('購物車項目不存在或已過期。'); }
                    throw new Error(`移除餐點失敗 (狀態碼: ${response.status})`);
                }

                showMessage('success', '餐點已從購物車移除！');
                loadCart(); 

            } catch (error) {
                console.error('移除餐點失敗:', error);
                showMessage('error', `移除餐點失敗: ${error.message}`);
            }
        }

        async function clearCart() {
            if (!confirm('確定要清空整個購物車嗎？')) {
                return;
            }
            try {
                const response = await fetch(`${API_CART_BASE_URL}/member/${MEMBER_ID}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`清空購物車失敗 (狀態碼: ${response.status})`);
                }

                showMessage('success', '購物車已清空！');
                loadCart(); 

            } catch (error) {
                console.error('清空購物車失敗:', error);
                showMessage('error', `清空購物車失敗: ${error.message}`);
            }
        }

        // --- 頁面載入時執行的初始操作 ---
        loadCart();
    });
</script>

</body>
</html>